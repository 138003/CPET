<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPET 臨床報告生成器</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen pb-10">
    <div class="max-w-2xl mx-auto mt-8 bg-white shadow-xl rounded-lg overflow-hidden">
        <div class="bg-indigo-700 p-4 text-white">
            <h1 class="text-xl font-bold">CPET 數據換算與報告生成</h1>
        </div>

        <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-4">
                <h2 class="font-bold border-b pb-1 text-indigo-600 text-sm">基本與心率</h2>
                <div class="grid grid-cols-2 gap-2">
                    <label class="text-xs">年齡: <input id="age" type="number" value="29" class="w-full p-1 border rounded"></label>
                    <label class="text-xs">Peak HR: <input id="peakHR" type="number" class="w-full p-1 border rounded"></label>
                </div>

                <h2 class="font-bold border-b pb-1 text-indigo-600 text-sm">氧耗量 (VO2)</h2>
                <div class="grid grid-cols-2 gap-2">
                    <label class="text-xs">Peak VO2 (ml/kg/min): <input id="peakVO2_ml" type="number" step="0.1" class="w-full p-1 border rounded"></label>
                    <label class="text-xs">Peak VO2 (L/min): <input id="peakVO2_L" type="number" step="0.01" class="w-full p-1 border rounded"></label>
                    <label class="text-xs">Pred. VO2 (L/min): <input id="predVO2_L" type="number" step="0.01" class="w-full p-1 border rounded"></label>
                </div>

                <h2 class="font-bold border-b pb-1 text-indigo-600 text-sm">通氣與肺功能</h2>
                <div class="grid grid-cols-2 gap-2">
                    <label class="text-xs">VE max (L/min): <input id="veMax" type="number" class="w-full p-1 border rounded"></label>
                    <label class="text-xs">FEV1 (L): <input id="fev1" type="number" step="0.01" class="w-full p-1 border rounded"></label>
                </div>

                <h2 class="font-bold border-b pb-1 text-indigo-600 text-sm">其他指標</h2>
                <div class="grid grid-cols-2 gap-2">
                    <label class="text-xs">OUES: <input id="oues" type="number" class="w-full p-1 border rounded"></label>
                    <label class="text-xs">VE/VCO2 slope: <input id="vevco2" type="number" step="0.1" class="w-full p-1 border rounded"></label>
                    <label class="text-xs">O2 pulse: <input id="o2p" type="number" step="0.1" class="w-full p-1 border rounded"></label>
                    <label class="text-xs">Pred. O2 pulse: <input id="predO2p" type="number" step="0.1" class="w-full p-1 border rounded"></label>
                </div>

                <button onclick="generateReport()" class="w-full bg-indigo-600 text-white font-bold py-2 rounded mt-4 hover:bg-indigo-700">生成報告</button>
            </div>

            <div class="bg-gray-50 p-4 border rounded shadow-inner">
                <h2 class="font-bold mb-2 text-sm">報告預覽:</h2>
                <textarea id="reportText" class="w-full h-80 p-2 text-sm font-mono border bg-white" readonly></textarea>
                <button onclick="copyToClipboard()" class="w-full mt-2 bg-green-600 text-white text-sm py-2 rounded hover:bg-green-700">複製報告內容</button>
            </div>
        </div>
    </div>

    <script>
        function generateReport() {
            // 讀取數值
            const age = parseFloat(document.getElementById('age').value);
            const peakHR = parseFloat(document.getElementById('peakHR').value) || 0;
            const peakVO2_ml = parseFloat(document.getElementById('peakVO2_ml').value) || 0;
            const peakVO2_L = parseFloat(document.getElementById('peakVO2_L').value) || 0;
            const predVO2_L = parseFloat(document.getElementById('predVO2_L').value) || 0;
            const veMax = parseFloat(document.getElementById('veMax').value) || 0;
            const fev1 = parseFloat(document.getElementById('fev1').value) || 1; // 避免除以0
            const oues = parseFloat(document.getElementById('oues').value) || 0;
            const vevco2 = parseFloat(document.getElementById('vevco2').value) || 0;
            const o2p = parseFloat(document.getElementById('o2p').value) || 0;
            const predO2p = parseFloat(document.getElementById('predO2p').value) || 1;

            // 邏輯計算
            const pPeakHR = (peakHR * 100 / (220 - age)).toFixed(1);
            const peakMETs = (peakVO2_ml / 3.5).toFixed(1);
            const pPeakVO2 = (peakVO2_L * 100 / predVO2_L).toFixed(1);
            const fai = (100 - (peakVO2_L / predVO2_L * 100)).toFixed(1);
            const di = (veMax / (40 * fev1)).toFixed(2);
            const br = (1 - di).toFixed(2);
            const pO2p = (o2p * 100 / predO2p).toFixed(1);

            // 格式化報告內容
            const report = 
`1. max HR:${peakHR};% predicted peak HR=${pPeakHR}%
2. peak VO2:${peakVO2_ml}ml/kg/min; peak MET:${peakMETs}METs;% predicted peak VO2:${pPeakVO2}%
3. % FAI=${fai}%
4. Dyspnea index=${di};Breathing reserve=${br}
7. OUES: ${oues} ml/min
8. VE/VCO2 slope: ${vevco2}
9. O2 pulse: ${o2p} ; ${pO2p}% of predicted`;

            document.getElementById('reportText').value = report;
        }

        function copyToClipboard() {
            const copyText = document.getElementById("reportText");
            copyText.select();
            document.execCommand("copy");
            alert("報告內容已複製到剪貼簿！");
        }
    </script>
</body>
</html>
